{% extends 'layout.html' %}

{% block title %} - {{user.name}}{% endblock %}

{% block scripts %}
    <script src="{{url_for('static', filename='scripts/profile.js')}}" defer></script>
{% endblock %}

{% block stylesheets %} <link rel="stylesheet" href="{{url_for('static', filename='stylesheets/profile.css')}}"> {% endblock %}

{% block content %}

<!--TODO! Testa come si comportano le scrollbar orizzotali con episodi con testi lunghi o "al limite"-->

<!-- Profile header (propic, info) -->
<div class="row">
    <div class="col-12 col-lg-4 d-flex justify-content-center align-items-center">
        <!--Propic-->
        <img src="{{url_for('static', filename='uploads/images/propics/{0}{1}'.format(user.id, user.propic))}}" alt="Immagine profilo" class="img-fluid border rounded-4">
    </div>
    <div class="col">
        <!--Nome e cognome -->
        <div class="row display-4 mt-3 mt-lg-0 mb-3 mx-lg-0 mx-2"><p class="text-nowrap">{{user.name}} {{user.surname}} {% if is_creator %}<i class="ms-2 fa-solid fa-podcast fa-xs"></i>{% endif %}</p></div>
        <!--Bio-->
        <div class="row mx-lg-0 mx-2 ps-2">

            {% if not user.bio %}
                {% if is_owner %}
                <p>Nessuna bio... üò¢ <a class="vanilla-a" data-bs-toggle="modal" data-bs-target="#editBio"> vuoi aggiungerne una?</a></p>
                {% else %}
                Nessuna bio... üò¢
                {% endif %}
            {% else %}
                <p>{{user.bio}}
                    {% if is_owner %}
                        <a data-bs-toggle="modal" data-bs-target="#editBio" class="vanilla-a"><i class="ms-2">Modifica bio</i><i class="fa-solid fa-pen-to-square ms-2"></i></a>
                    {% endif %}
                </p>
            {% endif %}

        </div>
        
        <!-- Modal (update bio) -->
        <div class="modal fade" id="editBio" tabindex="-1" aria-labelledby="editBioLabel" aria-hidden="true">
            <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                <h1 class="modal-title fs-5" id="editBioLabel">Modifica biografia profilo</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="{{url_for('post_edit_bio', id=user.id)}}" method="POST">
                        <textarea id="bio-input" name="bio" class="form-control mt-2" rows="16" maxlength="516">{{user.bio}}</textarea>
                        <button type="submit" class="btn btn-dark btn-outline-light mt-3">Conferma</button>
                    </form>
                </div>
            </div>
            </div>
        </div>

    </div>
</div>

<!-- Profile body (podcast pubblicati e seguiti) -->
<div class="row">

    {% if is_owner or (not is_owner and privacy[0] == 0) %}
    {% if is_creator or is_owner %}
    <!-- Lista podcast pubblicati (bootstrap card) -->
    <div class="row mt-3">
        <div id="owned" class="card mb-3 mx-lg-0 mx-2 p-0">
            <div class="row g-0">
                <!-- Card header -->
                <div class="col-12 col-xxl-3 card-header d-flex flex-column justify-content-evenly align-items-center display-6">
                    <p class="row text-nowrap text-wrapper">Podcast üéôÔ∏è</p>
                    
                    {% if is_creator %}
                    <div class="row g-5">
                            {% if is_owner %}
                            <a href="{{url_for('privatize_owned', id=user.id)}}" class="col d-flex justify-content-center align-items-center"><i class="fa-solid fa-eye{% if privacy[0]==1 %}-slash{% endif %} fa-xxs"></i></a>
                            {% endif %}
                            <a href="{{url_for('owned', id=user.id)}}" class="col btn btn-light btn-outline-dark text-nowrap">Visualizza tutti</a>
                    </div>
                    {% endif %}
                    
                </div>
                <!-- Card body -->
                <div class="col">
                    <div class="card-body row g-2">
                        {% if is_creator %}
                        <div class="card-scroll">

                            {% for podcast in podcasts[:5] %}
                            
                            <a href="{{url_for('podcast', id=podcast.id)}}" class="d-inline-block mx-2 border rounded-2 px-2">
                                <div class="row">
                                <div class="col-4 d-flex align-items-center justify-content-center">
                                    <img src="{{url_for('static', filename='uploads/images/covers/{0}{1}'.format(podcast.id, podcast.img))}}" class="im-card img-fluid" alt="Card image" style="max-width: 100px;">
                                </div>
                                <div class="col-8 mt-2" style="max-width: 250px;">
                                    {% if podcast.title|length > 23 %}
                                        <h5 class="text-wrap text-break">{{podcast.title[:20]}}...</h5>
                                    {% else %}
                                        <h5 class="text-wrap text-break">{{podcast.title}}</h5>
                                    {% endif %}
                                    {% if podcast.desc|length > 70 %}
                                        <p class="text-wrap text-break">{{podcast.desc[:67]}}...</p>
                                    {% else %}
                                        <p class="text-wrap text-break">{{podcast.desc}}</p>
                                    {% endif %}
                                </div>
                                </div>
                            </a>

                            {% endfor %}

                        </div>

                        {% else %}
                            <h5 class="card-title mb-0">Nulla da vedere! üëÄ</h5>
                            <p class="card-text">Diventa un podcaster per pubblicare il tuo primo podcast!</p>
                            <small class="text-muted">Premi il bottone a destra üëâ</small>
                        {% endif %}                            
                        
                    </div>
                </div>
                {% if current_user.id == user.id %}
                <!-- Card footer -->
                <a href="{{url_for('new_podcast')}}" class="col-12 col-lg-1 btn btn-lg btn-light border-start rounded-0-start border-dark-start bg-light d-flex flex-lg-column justify-content-center align-items-center" role="button">
                    <div>{% if podcasts %}Nuovo podcast{% else %}Diventa podcaster!{% endif %}</div>
                    <i class="fa-solid fa-microphone mt-0 ms-3 mt-lg-3 ms-lg-0" style="font-size: x-large;"></i>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
    {% endif %}

    {% if is_owner or (not is_owner and privacy[1] == 0) %}
    <!-- Lista podcast seguiti (bootstrap card) -->
    <div class="row mt-3">
        <div id="follows" class="card mb-3 mx-lg-0 mx-2 p-0">
            <div class="row g-0">
                <!-- Card header -->
                <div class="col-12 col-xxl-3 card-header d-flex flex-column justify-content-evenly align-items-center display-6">
                    <div class="row my-4 d-flex justify-content-center align-items-center">
                        <p class="text-nowrap text-center mb-0">Seguiti ü•≥</p>
                    </div>
                    
                    {% if is_owner %}
                        <div class="row g-5">
                            <a href="{{url_for('privatize_follows', id=user.id)}}" class="col d-flex justify-content-center align-items-center"><i class="fa-solid fa-eye{% if privacy[1]==1 %}-slash{% endif %} fa-xxs"></i></a>
                            {% if follows|length > 0 %}
                                <a href="{{url_for('follows', id=user.id)}}" class="col btn btn-light btn-outline-dark text-nowrap">Visualizza tutti</a>
                            {% elif follows|length == 0 and is_owner %}
                                <a href="{{url_for('categories')}}" class="col btn btn-light btn-outline-dark text-nowrap">Trova podcasts</a>
                            {% endif %}
                        </div>
                    {% else %}
                        {% if follows|length > 0 %}
                        <div class="row g-5">
                            <a href="{{url_for('follows', id=user.id)}}" class="col btn btn-light btn-outline-dark text-nowrap">Visualizza tutti</a>
                        </div>
                        {% elif follows|length == 0 and is_owner %}
                        <div class="row g-5">
                            <a href="{{url_for('categories')}}" class="col btn btn-light btn-outline-dark text-nowrap">Trova podcasts</a>
                        </div>
                        {% endif %}
                    {% endif %}

                </div>
                <!-- Card body -->
                <div class="col">
                    <div class="card-body row g-2">
                        {% if follows %}
                        <div class="card-scroll">

                            {% for follow in follows[:5] %}
                            
                            <a href="{{url_for('podcast', id=follow.id_podcast)}}" class="d-inline-block mx-2 border rounded-2 px-2">
                                <div class="row">
                                    <div class="col-4 d-flex align-items-center justify-content-center">
                                        <img src="{{url_for('static', filename='uploads/images/covers/{0}{1}'.format(follow.id, follow.img))}}" class="img-fluid" alt="Card image" style="max-width: 100px;">
                                    </div>
                                    <div class="col-8 mt-2" style="max-width: 250px;">
                                        {% if follow.title|length > 23 %}
                                            <h5 class="text-wrap text-break">{{follow.title[:20]}}...</h5>
                                        {% else %}
                                            <h5 class="text-wrap text-break">{{follow.title}}</h5>
                                        {% endif %}
                                        <!--TODO! Incorpora la logica dei puntini... anche per episodi salvati e i tuoi podcast-->
                                        {% if follow.desc|length > 70 %}
                                            <p class="text-wrap text-break">{{follow.desc[:67]}}...</p>
                                        {% else %}
                                            <p class="text-wrap text-break">{{follow.desc}}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </a>

                            {% endfor %}
                            
                        </div>
                        {% else %}
                            <h5 class="card-title mb-0">Nulla da vedere! üëÄ</h5>
                            {% if is_owner %}
                                <p class="card-text"><small class="text-muted">Segui i tuoi podcast preferiti per vederli qui la prossima volta!</small></p>
                            {% else %}
                                <p class="card-text"><small class="text-muted">{{user.name}} non segue nessun podcast!</small></p>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    {% if is_owner or (not is_owner and privacy[2] == 0) %}
    <!-- Lista episodi salvati -->
    <div class="row mt-3">
        <div id="saves" class="card mb-3 mx-lg-0 mx-2 p-0">
            <div class="row g-0">
                <!-- Card header -->
                <div class="col-12 col-xxl-3 card-header d-flex flex-column justify-content-evenly align-items-center display-6">
                    <div class="row my-4 d-flex justify-content-center align-items-center">
                        <p class="text-nowrap text-center mb-0">Episodi salvati üìã</p>
                    </div>

                    {% if is_owner %}
                        <div class="row g-5">
                            <a href="{{url_for('privatize_saves', id=user.id)}}" class="col d-flex justify-content-center align-items-center"><i class="fa-solid fa-eye{% if privacy[2]==1 %}-slash{% endif %} fa-xxs"></i></a>
                            {% if follows|length > 0 %}
                                <a href="{{url_for('follows', id=user.id)}}" class="col btn btn-light btn-outline-dark text-nowrap">Visualizza tutti</a>
                            {% elif follows|length == 0 and is_owner %}
                                <a href="{{url_for('categories')}}" class="col btn btn-light btn-outline-dark text-nowrap">Trova podcasts</a>
                            {% endif %}
                        </div>
                    {% else %}
                        {% if follows|length > 0 %}
                        <div class="row g-5">
                            <a href="{{url_for('saves', id=user.id)}}" class="col btn btn-light btn-outline-dark text-nowrap">Visualizza tutti</a>
                        </div>
                        {% elif follows|length == 0 and is_owner %}
                        <div class="row g-5">
                            <a href="{{url_for('categories')}}" class="col btn btn-light btn-outline-dark text-nowrap">Trova podcasts</a>
                        </div>
                        {% endif %}
                    {% endif %}

                </div>
                <!-- Card body -->
                <div class="col">
                    <div class="card-body g-2">
                        {% if saves %}
                        <div class="card-scroll">

                            {% for save in saves[:5] %}
                            
                            <a href="{{url_for('episode', id_pod=save.id, id_ep=save.ep_id)}}" class="d-inline-block mx-2 border rounded-2 px-2">
                                <div class="row">
                                    <div class="col-4 d-flex align-items-center justify-content-center">
                                        <img src="{{url_for('static', filename='uploads/images/covers/{0}{1}'.format(save.id, save.img))}}" class="img-fluid" alt="Card image" style="max-width: 100px;">
                                    </div>
                                    <!--TODO! Rimovi l'attribute style-->
                                    <div class="col-8 mt-2" style="max-width: 250px;">
                                        {% if save.title|length > 23 %}
                                            <h5 class="text-wrap text-break">{{save.title[:20]}}...</h5>
                                        {% else %}
                                            <h5 class="text-wrap text-break">{{save.title}}</h5>
                                        {% endif %}
                                        <!--TODO! Incorpora la logica dei puntini... anche per episodi salvati e i tuoi podcast-->
                                        {% if save.desc|length > 70 %}
                                            <p class="text-wrap text-break">{{save.desc[:67]}}...</p>
                                        {% else %}
                                            <p class="text-wrap text-break">{{save.desc}}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </a>

                            {% endfor %}
                            
                        </div>
                        {% else %}
                            <h5 class="card-title mb-0">Nulla da vedere! üëÄ</h5>
                            {% if is_owner %}
                                <p class="card-text"><small class="text-muted">Salva i tuoi episodi preferiti per vederli qui la prossima volta!</small></p>
                            {% else %}
                                <p class="card-text"><small class="text-muted">{{user.name}} non ha ancora salvato nessun episodio!</small></p>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

</div>

{% endblock %}